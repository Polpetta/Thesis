% Tutto quello riguardante il progetto andrà in questo capitolo

\chapter{Il progetto}
\label{cap:progetto}

\section{I ricordi}

La vita di ogni persona è composta da ricordi. Sempre più oggi giorno la gente
salva i propri istanti tramite i \textit{social network}, come ad esempio
Facebook o Instagram. Ma questi momenti tendono a svanire col tempo o possono
perdersi nella vastità di internet. Quello che PastBook offre è la
possibilità di renderli permanenti in un album fotografico prendendo i momenti
salvati nei \textit{social network}. Questa operazione è resa ancora più
semplice se il tutto è assistito da un \textit{bot}, che rende il processo più e
\textit{user-friendly}.

\subsection{L'era dei \textit{bot}}

Dal lancio iniziale sulla piattaforma di messaggistica di Telegram dei
\textit{bot}, si è potuto notare come ci sia stato un maggior interessamento
verso questa tecnologia. L'entrata di Facebook tramite la sua applicazione di
messaggistica Messenger ha segnato un importante passo anche nel modo in cui le
aziende possono interagire con i propri clienti. È ora possibile scrivere
direttamente alle pagine dei servizi a cui si è interessati per ottenere aiuto o
informazioni in pochi secondi, facendo risparmiare agli utenti la fatica di
andarsele a cercare nel sito della compagnia.

%https://www.microsoft.com/cognitive-services/en-us/language-understanding-intel
%igent-service-luis
%https://wit.ai/
Questo ha fatto spingere i grandi colossi come Microsoft e Facebook stessa a
spingere molto verso la branchia dell'intelligenza artificiale, per poter dare
alle macchine la possibilità di interpretare al meglio il linguaggio naturale
degli esseri umani.

\section{PastBot}

Appena uscita la possibilità di creare \textit{bot} su Facebook e collegarli
alle pagine delle aziende PastBook si è subito attivata per creare il suo
\textit{bot} che aiuti le persone nella creazione degli album in maniera
interattiva rendendo facile il loro acquisto in seguito. Questo permette anche
agli utenti la creazione e acquisto di album comodamente e direttamente da
Facebook.

Una volta arrivato nella pagina della società, l'utente non deve far altro che
scrivergli un messaggio. Al primo messaggio si attiverà il \textit{bot} che
gli risponderà cortesemente illustrandogli le sue funzionalità e comandi.
L'utente potrà chiedere aiuto al \textit{bot}, che lo guiderà nei passi
necessari per creare un album. Quando finalmente l'utente ha inviato il numero
minimo delle foto necessarie per creare l'album, verrà informato da PastBot che
gli offrirà la possibilità di acquistarlo. Questo porterà l'utente in una
procedura automatica di acquisto, in cui gli unici campi richiesti saranno
solamente selezionare il tipo di pagamento, la località dove spedire il libro
dei ricordi appena creato e in che formato lo si desidera. \\

Essendo l'utente un essere umano si è dovuto considerare dei possibili errori
che esso può commettere:
\begin{itemize}
  \item errori in fase di digitazione;
  \item errori nell'invio delle immagini;
  \item errori nell'interpretazione dei messaggi del \textit{bot}.
\end{itemize}

\paragraph*{Errori di digitazione} Per gli errori di digitazione il \textit{bot}
segnalerà all'utente l'eventuale errore (se l'errore si trova nella parola
chiave del comando), chiedendogli di effettuare di nuovo l'operazione richiesta.

\paragraph*{Errori nell'invio delle immagini} Durante l'invio delle immagini, è
possibile che l'utente possa commettere un errore nella selezione e possa
inviare anche altri contenuti, come file generici o video. In questo caso, il
\textit{bot} ignorerà i contenti diversi da immagini che sono stati inviati,
senza lanciare un messaggio di errore o fermare l'operazione di caricamento.
Questa scelta è stata presa in quando è possibile che questo tipo di errore
avvenga maggiormente quando l'utente vuole inviare un gran numero di foto nella
chat, e eseguire azioni come segnalare l'errore o fermare il processo di
salvataggio delle immagini potrebbe portare a reazioni come frustrazione e
fastidio nel dover eseguire di nuovo queste operazioni.

\paragraph*{Errori di interpretazioni} È anche possibile che le persone
commettano degli errori nell'interpretare il senso della frase che il
\textit{bot} manda loro. Questo potrebbe portare a un errore nella procedura
richiesta dal \textit{bot}. Un tipico esempio potrebbe essere richiedere la
lista delle foto di un album che è attualmente vuoto. In questo caso il
\textit{bot} segnalerà all'utente che l'azione non è disponibile, e provvederà
a fornirgli una lista di azioni che può intraprendere. In questa maniera si
inviterà l'utente a continuare attivamente la discussione.

\subsection{Azioni intraprendibili dall'utente}

L'utente può intraprendere con PastBot diversi tipi di azioni. Di seguito si
elencano le possibili:

%magari è meglio usare una tabella qui?
\begin{itemize}

  \item richiedere informazioni riguardo al funzionamento del \textit{bot};
  \item richiedere informazioni riguardo ai costi di spedizione e ai formati
degli album;
  \item creare un nuovo album;
  \item inviare foto al \textit{bot} tramite la chat utente;
  \item vedere la lista delle foto inviate e attualmente presenti all'interno
dell'album;
  \item richiedere di vedere, a grandezza originale e senza alcuna riduzione di
risoluzione un'immagine presente nella lista dell'album che si sta creando;
  \item richiedere di cancellare una specifica foto dall'album che si sta
creando;
  \item procedere con l'acquisto dell'album.
\end{itemize}

\subsection{Implementazione tecnica}

\subsubsection{Amazon AWS Lambda}
%https://aws.amazon.com/lambda/
PastBook basa i suoi servizi nel \textit{cloud} grazie a Amazon AWS Services.
Per realizzare il \textit{bot} è quindi stato deciso di pensarlo utilizzando
un'architettura serverless con database non relazionali (ovvero di tipo
\glslink{nosql}{NoSQL}). Un architettura di questo tipo porta a diversi
vantaggi:

\begin{itemize}

  \item nessun costo di amministrazione dei server in cui il programma viene
eseguito;
  \item \textit{scaling} automatico dell'applicazione in base alle richieste in
arrivo, per offrire un servizio all'utenza senza interruzioni;
  \item i costi sono legati solamente al tempo di esecuzione effettivo del
programma nel \textit{cloud};
  \item risorse automaticamente gestite;
  \item \textit{log} automatico dell'applicazione;
  \item raccolta automatica di metriche e statistiche sull'utilizzo delle
risorse;
  \item tutto l'ambiente è all'interno dello stesso \textit{cloud}, permettendo
una comunicazione interna molto rapida e riducendo i tempi di chiamate delle
varie API.
\end{itemize}

Questo tipo di vantaggi ha permesso anche durante il tirocinio di focalizzarsi
prevalentemente nella stesura del codice senza preoccuparsi della parte di
amministrazione del sistema.

Il servizio \textit{cloud} utilizzato nello specifico si chiama Amazon AWS
Lambda, e permette di configurare quante risorse per quanto tempo il programma
potrà avere.
AWS Lambda permette di caricare il codice sotto forma di "funzioni". Queste
funzioni non sono altro che porzioni di codice (che possono essere composte da
più file).
Nella configurazione sarà poi necessario definire il metodo della
"funzione" da invocare al sopraggiungere di una richiesta. A questa funzione
verrà passato un evento sotto forma di oggetto
\glslink{javascript_object_notation}{JSON}. I campi per l'oggetto sono
definibili e personalizzabili nella configurazione della funzione, oppure si può
scegliere di ricevere tutti i campi dell'evento.
Per poter automatizzare anche questa configurazione, creando
quindi un sistema completamente automatizzato per la distribuzione del
codice, si è deciso di utilizzare lo strumento open source Apex.

\subsubsection{Apex}
% http://apex.run/
Apex è uno strumento che permette di automatizzare la fase di distribuzione del
codice sorgente con configurazioni personalizzabili in base all'ambiente in cui
si distribuisce il programma. Oltre a queste funzionalità, permette anche di:
\begin{itemize}
  \item eseguire la funzione direttamente da linea di comando (il codice verrà
comunque eseguito in remoto);
  \item visualizzazione di metriche sull'utilizzo del programma;
  \item visualizzazione di \textit{log} di esecuzione.
\end{itemize}

Per utilizzare questo strumento è stato necessario creare la struttura del
progetto secondo quanto specificato dalla documentazione del programma.

\paragraph*{Struttura di un progetto Apex}

\begin{figure}[H]
  \centering
  \includegraphics[scale=0.7]{project_structure}
  \caption{Tipica struttura di un progetto Apex}
\end{figure}

% http://apex.run/#structuring-projects
Come è possibile notare nella figura, sono presenti diversi file di
configurazione di tipo \glslink{javascript_object_notation}{JSON}. Prima
dell'estensione del file è possibile notare come siano appuntati i vari tipi di
environment, per cui è possibile creare una configurazione diversa.
All'interno del file "project.<environment>.json" è possibile inserire i
seguenti campi:
\begin{itemize}
  \item \textbf{name}: il nome del progetto;
  \item \textbf{description}: una descrizione del progetto (questo campo può
essere opzionale);
  \item \textbf{runtime}: specifica ad Apex il tipo di linguaggio e la versione
dell'interprete per il linguaggio scelto che è necessario utilizzare. Le
versioni attualmente supportate dallo strumento sono maggiori di quelle che
permette il servizio Amazon Lambda, che è limitato solamente ai linguaggi come
JavaScript, Python e Java. Le opzioni disponibile per questo campo sono:
  \begin{itemize}
    \item java (utilizzo di Java versione 8)
    \item python (versione 2.7)
    \item nodejs (versione 0.10)
    \item nodejs4.3 (versione 4.3)
    \item golang (qualsiasi versione)
  \end{itemize}

  \item \textbf{memory}: la memoria che le varie macchine lambda disporranno.
La memoria utilizzabile varia da un minimo di 128 MB di RAM fino a un massimo
di 1536MB di RAM. Questo campo richiede l'inserimento di un valore intero;

  \item \textbf{timeout}: indica il tempo massimo di esecuzione della singola
funzione lambda: infatti è possibile che la macchina abbia dei periodi di
esecuzione più lunghi che non sono desiderati (soprattutto, per esempio, in
ambienti \textit{realtime}). Se l'esecuzione supera il limite impostato,
l'esecuzione verrà interrotta. Questo valore attualmente può essere impostato a
un massimo di 5 minuti;

  %http://docs.aws.amazon.com/general/latest/gr/aws-arns-and-namespaces.html
  \item \textbf{role}: all'interno dell'ambiente Amazon AWS sono presenti i
ruoli, che danno la possibilità di definire i permessi delle varie risorse
all'interno del servizio, siano essi utenti della compagnia o codice in
esecuzione. Ogni permesso è identificato tramite un \textit{Amazon Resource
Names} (anche abbreviato in ARN), che segue la seguente definizione:
\begin{verbatim}
  arn:partition:service:region:account-id:resource
\end{verbatim}
dove:
  \begin{itemize}
    \item[arn] identifica che si tratta di un ruolo;

    \item[partition] indica il tipo di luogo in cui si trova la risorsa.
Attualmente è solamente disponibile il valore "aws";

    \item[service] indica il servizio. Nel caso della configurazione necessaria
per il tirocinio, il valore è stato impostato a "lambda";

    \item[region] indica la regione dove questa risorsa è allocata. Amazon AWS
Services è un servizio presente in più regioni del mondo, e ogni regione
permette di avere una propria configurazione;

    \item[account-id] indica l'id dell'\textit{account} con cui si sta
assegnando il permesso;

    \item[resource] è il nome della risorsa, che è univoco per quel determinato
servizio nella regione selezionata.
  \end{itemize}
  L'assegnazione di un ruolo è obbligatoria e se non correttamente configurato
durante l'esecuzione del codice si potrebbero riscontrare problemi con i
permessi.

  \item \textbf{name-template}: questo campo indica il nome che la funzione
avrà quando sarà caricata nel servizio Amazon Lambda. Questo nome infatti può
essere personalizzato usando delle sequenze predefinite. Seguendo le
convenzioni stabilite all'interno di PastBook, il nome è stato definito in
questa maniera:
\begin{verbatim}
  {{.Project.Environment}}-{{.Function.Name}}
\end{verbatim}
Dove nella prima parte sarà il tipo di ambiente in cui verrà caricata la
funzione (ovvero o \textit{dev} o \textit{qa} o \textit{prod}) mentre nella
seconda si avrà il nome della cartella che ospita il codice della funzione;

  \item \textbf{handler}: questo parametro indica il nome del metodo della
funzione che Amazon Lambda chiamerà quando ne sarà richiesta l'esecuzione.
\end{itemize}


Una volta definito il file di configurazione per il progetto è possibile
cominciare a lavorare sulle funzioni che poi verranno caricate nel servizio
Amazon Lambda. Queste funzioni devono trovarsi all'interno di una propria
cartella all'interno di "function". Il nome della cartella indicherà anche il
nome della funzione. Per ogni funzione è poi possibile scrivere il codice che
verrà eseguito.


\paragraph*{Personalizzazione delle configurazioni} Apex è uno strumento
flessibile che permette di definire in maniera dettagliata ulteriori
configurazioni per ogni funzione, tramite la definizione di un file
"function.<environment>.json". Anche questo file è un oggetto di tipo
\glslink{javascript_object_notation}{JSON}, con gli stessi campi del file
"project.<environment>.json": ciò permette una ridefinizione dei valori dei
campi che si vuole personalizzare per quella funzione, consentendo quindi
la creazione di una configurazione globale per tutto il progetto e una
personalizzata per ogni funzione.
Come convenzione interna della compagnia è stato deciso di nominare tutti i
file che vengono poi eseguiti dal servizio Lambda con il nome di
\textit{index.js}.


\paragraph{Gestione e caricamento delle dipendenze} Il \textit{bot} durante lo
sviluppo ha richiesto la necessità di dipendenze di terze parti, e per questo è
stato deciso di integrarle tramite il gestore di moduli JavaScript NPM. 
%indicare cosa succede quando si carica il tutto
